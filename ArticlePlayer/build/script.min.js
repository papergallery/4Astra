define(["jquery","mod_longread/owl.carousel","mod_longread/rslides","mod_longread/colorpicker","jqueryui","touch_punch"],function(t,n,e,a,o){function r(t,n,e){if(document.selection){e.focus(),(a=document.selection.createRange()).text=t+a.text+n}else{var a,o=e.value.length,r=e.selectionStart,i=e.selectionEnd,s=e.scrollTop,l=e.scrollLeft,c=t+(a=e.value.substring(r,i))+n;e.value=e.value.substring(0,r)+c+e.value.substring(i,o),e.scrollTop=s,e.scrollLeft=l}}return{init:function(){var n=this;t(function(){t(".longread-fixed-menu-wrapper .menu-button").click(function(){t(this).parent().toggleClass("closed")}),t(".mod_longread-slider .owl-carousel").owlCarousel({nav:!0,navText:['<i class="fa fa-angle-left" aria-hidden="true"></i>','<i class="fa fa-angle-right" aria-hidden="true"></i>'],items:1,responsiveClass:!0,autoHeight:!0,lazyLoad:!0,lazyLoadEager:2}),t(".longread-wrapper .flip-card").click(function(){t(this).toggleClass("turn")}),t(".mod_longread-multitab").length&&t(".mod_longread-multitab").each(function(){t(".rslides",this).responsiveSlides({auto:!1,manualControls:t(".controls",this)})}),t(".longread-wrapper .mod_longread-matching").each(function(){var n=t('input[name="id"]',this).val();t(".longread-wrapper .mod_longread-matching .matching-sortable-"+n).sortable({connectWith:".longread-wrapper .mod_longread-matching .matching-sortable-"+n,items:".answer",update:function(n,e){if(t(this).parent().hasClass("matching")){var a=t(this).parents("form"),o=[];t(".matching>div",a).each(function(){t(".answer",this).each(function(){o.push(t(this).data("id"))})}),t('input[name="answer"]',a).val(JSON.stringify(o))}}}).disableSelection()}),t(".longread-wrapper .set-in-order-sortable").sortable({update:function(n,e){var a=t(this).parents("form"),o=[];t("label",this).each(function(){o.push(t(this).data("id"))}),t('input[name="answer"]',a).val(JSON.stringify(o))}}).disableSelection(),t(".mod_longread-fill-blank-words-cards .owl-carousel").owlCarousel({items:3,nav:!0,navText:["",""],center:!0,responsiveClass:!0,responsive:{0:{items:1,nav:!1},767:{items:1,nav:!1},1201:{items:3,nav:!0}}}),t(".longread-wrapper .mod_longread-choice-by-cards").each(function(){var n=t('input[name="id"]',this).val();t(".longread-wrapper .mod_longread-choice-by-cards .matching-sortable-"+n).sortable({connectWith:".longread-wrapper .mod_longread-choice-by-cards .matching-sortable-"+n,items:".answer",update:function(n,e){if(t(this).parent().hasClass("matching")){var a=t(this).parents("form"),o={};t(".matching>div",a).each(function(){var n,e=[];n=t(this).data("id").toString(),t(".answer",this).each(function(){e.push(t(this).data("id"))}),o[n]=e}),t('input[name="answer"]',a).val(JSON.stringify(o))}}}).disableSelection()}),t(".mod_longread-fill-blank-words form>button.btnAnswer").click(function(){if(1==t(this).attr("data-rep")){var n=t(this).attr("data-mod"),e=t('div .answers input[data-target|="answer-'+n+'"]');e.removeAttr("disabled"),e.val("")}}),t(".mod_longread-fill-blank-words-cards form>button.btnAnswer").click(function(){if(1==t(this).attr("data-rep")){var n=t(this).attr("data-mod"),e=t('.answers div[data-target|="answer-'+n+'"] input[name^="answer"]');e.val(""),e.removeAttr("disabled")}}),t(".mod_longread-matching-pics-words form>button.btnAnswer").click(function(){if(1==t(this).attr("data-rep")){var n=t(this).parents("form");t("span.answer",n).css("pointer-events","auto"),t("img.answer",n).css("pointer-events","auto")}else{n=t(this).parents("form");t("span.answer",n).css("pointer-events","none"),t("img.answer",n).css("pointer-events","none")}}),t(".mod_longread-matching-words form>button.btnAnswer").click(function(){if(1==t(this).attr("data-rep")){var n=t(this).parents("form");t("span.answer",n).css("pointer-events","auto")}else{n=t(this).parents("form");t("span.answer",n).css("pointer-events","none")}}),t(".mod_longread-choice-by-cards form>button.btnAnswer").click(function(){if(1==t(this).attr("data-rep")){var n=t(this).parents("form");t("span.answer",n).css("pointer-events","auto")}else{n=t(this).parents("form");t("span.answer",n).css("pointer-events","none")}}),t(".mod_longread-set-in-order form>button.btnAnswer").click(function(){if(1==t(this).attr("data-rep")){var n=t(this).parents("form");t("label.setinord",n).css("pointer-events","auto")}else{n=t(this).parents("form");t("label.setinord",n).css("pointer-events","none")}}),t(".longread-wrapper form>button").click(function(){var n=t(this).parents("form"),e=n.serialize(),a=t("button.btnAnswer",n).attr("data-rep");if(0==a)t.post("/mod/longread/ajax.php",e,function(e){"object"==typeof e&&null!==e&&(e.hasOwnProperty("msg")?alert(e.msg):(t("button.btnAnswer",n).html("Попробовать еще раз"),t("button.btnAnswer",n).attr("data-rep",1)),e.hasOwnProperty("data")&&(t("button",n).attr("disabled",!0),t("button",n).css("cursor","wait"),t("button",n).css("background}","#8181bd"),setTimeout(function(){t("button",n).removeAttr("disabled"),t("button",n).css("cursor","pointer"),t("button",n).css("background}","#6162ac")},3e3),["choice","right","wrong"].forEach(function(a){void 0!==e.data[a]&&e.data[a].forEach(function(e){var o=t('[data-target="'+e+'"]',n);o.addClass(a),!0===o.data("label")&&o.append('<span class="'+a+'"></span>')})})))});else if(1==a){["choice","right","wrong"].forEach(function(e){var a=t("."+e,n);a.removeClass(e),a.find("span ."+e).remove()}),t("button.btnAnswer",n).html("Проверить"),t("button.btnAnswer",n).attr("data-rep",0)}}),t(document).ready(function(){var n,e=document.getElementsByClassName("mod_longread-screen"),a=0;t.each(e,function(t,n){var e=n.innerText;e=e.replace(/\u00A0/g,"").replace("\t","").replace(/\r\n?|\n/g," ").replace(/ {2,}/g," ").replace(/^ /,"").replace(/ $/,""),a+=e.length,e.split(" ").length});let o=t("[data-treading]"),r=0;o.each(function(){let n=t(this).attr("data-treading");r+=Number(n)}),t(".mod_longread-screen img").length;var i=function(t,n){return n[t%100>4&&t%100<20?2:[2,0,1,1,1,2][t%10<5?t%10:5]]};if((n=Math.ceil(a/1500+r/60))>60){let t=Math.trunc(n/60),e=n%60;var s=t+" "+i(t,["час","часа","часов"])+" "+e+" "+i(e,["минута","минуты","минут"])}else s=n+" "+i(n,["минута","минуты","минут"]);t(".timeread").length>0&&t(".timeread").html(s)}),n.init_sort()})},init_sort:function(){t(".local-table-sortable tbody").sortable({handle:".local-table-move",update:function(n,e){var a={ids:[],action:""};t(".local-table-move").length&&(t(".local-table-move").each(function(){a.ids.push(t(this).data("id"))}),a.action=t(".local-table-move:eq(0)").data("action"),t.post("/mod/longread/ajax.php",a,function(t){window.location.reload()}))}}).disableSelection()},set_oneline_wysiwyg:function(){t("input[data-oneline-wysiwyg]").length&&(t("input[data-oneline-wysiwyg]").each(function(){t(this).before('<div class="mb-1"><button type="button" class="btn btn-primary mr-1 oneline-wysiwyg-b">Выделить</button><button type="button" class="btn btn-info oneline-wysiwyg-g">Глоссарий</button></div>')}),t(document).on("click",".oneline-wysiwyg-b",function(){r("¿","¿",t(this).parent().parent().find("input[data-oneline-wysiwyg]")[0])}),t(document).on("click",".oneline-wysiwyg-g",function(){r("|","|",t(this).parent().parent().find("input[data-oneline-wysiwyg]")[0])}))},initColorPicker:function(){t("input[name='color1']").ColorPicker({onSubmit:function(n,e,a,o){t(o).val(e),t(o).ColorPickerHide()},onBeforeShow:function(){t(this).ColorPickerSetColor(this.value)},onChange:function(n,e,a,o){t("input[name='color1']").val(e)}}),t("input[name='color2']").ColorPicker({onSubmit:function(n,e,a,o){t(o).val(e),t(o).ColorPickerHide()},onBeforeShow:function(){t(this).ColorPickerSetColor(this.value)},onChange:function(n,e,a,o){t("input[name='color2']").val(e)}})}}});