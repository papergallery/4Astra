define(["jquery","jqueryui"],function(t){return{speech:function(){function e(e){e.paused?(t(".btn-speech-ply").removeClass("pause"),t(".btn-note-ply").removeClass("pause"),t(".btn-speech-ply").addClass("play"),t(".btn-note-ply").addClass("play")):(t(".btn-speech-ply").removeClass("play"),t(".btn-note-ply").removeClass("play"),t(".btn-speech-ply").addClass("pause"),t(".btn-note-ply").addClass("pause"))}function a(e){return t("html, body").animate({scrollTop:t('[number="'+e+'"]').offset().top-200},1e3),!1}function n(e){var a=t(".btn-note-ply.pause").parent().attr("data-id-note");if(!t(".btn-note-ply.pause").length||a!=e){var n=t('[data-id-note="'+e+'"]');if(t(n).addClass("activetag"),!t(".btn-note-ply.play").length){var o=t('<button class="play btn-outline-dark btn-note-ply" id="button"></button>');t(n).append(o)}}}function o(e){e?(t(".btn-note-ply").parent().removeClass("activetag"),t(".btn-note-ply").remove()):(t(".btn-note-ply.play").parent().removeClass("activetag"),t(".btn-note-ply.play").remove())}function l(e,a){return function(e){t.ajax({url:"ajax_speech.php",type:"POST",dataType:"json",data:{action:"saveuser",currentidnote:e,coursemoduleid:t.urlParam("id")},async:!1})}(t('[number="'+a+'"]').attr("data-id-note")),t(".btn-speech-ply").attr("globalNumber",a),t(".btn-speech-ply").attr("number",a),console.log("play_play: "+a),e.src=t('[number="'+a+'"]').attr("data-audiourl"),e}function s(e){return t('[number="'+e+'"]').attr("data-id-note")}function r(e){return t('[data-id-note="'+e+'"]').attr("number")}function d(a,r,d,p){(a=l(a,d)).play(),e(a),t(".btn-speech-ply").attr("number",d),console.log("play_play: "+d),t(a).on("ended",function(){s(d);o(!0),d!=p&&(n(s(++d)),a=l(a,d),console.log("play_play: "+d),t(".btn-speech-ply").attr("number",d),a.play(),e(a))})}function p(){var e=t(".btn-speech-ept");e.removeClass("play"),e.addClass("lds-dual-ring-sch"),console.log("Старт закачки всех спичей");var a=t("[data-id-note]").length,n=0,o=0,l=1;t("[data-id-note]").each(function(){n++,console.log(a),console.log(n),a===n&&(o=1),t(this).text().length&&(!function(e,a){console.log("Старт закачки спича");var n=t('[data-id-note="'+e+'"]').text();t.ajax({type:"GET",async:!0,url:"../longread/speech.php",data:{action:"SendData",SendText:n,SendNoteid:e,moduleid:t.urlParam("id")},success:function(n){console.log("Подстановка ссылки: "+n+" idnote: "+e),t('[data-id-note="'+e+'"]').attr("data-audiourl",n),1===a&&(t(".btn-speech-ept").removeClass("lds-dual-ring-sch"),t(".btn-speech-ept").addClass("play"),t(".btn-speech-ept").addClass("btn-speech-ply"),t(".btn-speech-ply").attr("number",1))}})}(t(this).attr("data-id-note"),o),t(this).attr("number",l),l++)}),console.log("Закачка всех спичей конец")}t.urlParam=function(t){var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.href);return null==e?null:decodeURI(e[1])||0},t(document).ready(function(){var l,c=function(){var e;return t.ajax({url:"ajax_speech.php",type:"POST",dataType:"json",async:!1,data:{action:"speechload",coursemoduleid:t.urlParam("id")},success:function(a){t.each(a.data,function(e,a){t('[data-id-note="'+a.noteid+'"]').attr("data-audiourl",a.audiourl)}),t.each(a.dataUsr,function(t,a){e=a.noteid})}}),console.log(e),e}();l=!0,t("[data-id-note]").each(function(){t(this).text().length&&(t(this).attr("data-audiourl")||(l=!1))}),l||(t(".btn-speech-ply").addClass("btn-speech-dwn"),t(".btn-speech-ply").removeClass("btn-speech-ply"));var u,i,b=document.getElementById("audio"),h={};if(t(document).on("click",".btn-speech-dwn",function(){console.log("Закачка всех спичей старт"),t(this).removeClass("btn-speech-dwn"),p()}),i=1,t("[data-id-note]").each(function(){t(this).text()&&t(this).attr("data-audiourl")&&(t(this).attr("number",i),i++)}),u=i,c){var y=r(c);t(".btn-speech-ply").attr("number",y)}else t(".btn-speech-ply").attr("number",1);t("[data-id-note]").mouseenter(function(){var e=t(this).attr("data-id-note");t(this).attr("data-audiourl")&&n(e);var a=t(this).parents("[data-id-note]").last();a.length||(a=t(this)),a.find(h.btnadd).length||0==a.children(".btn-note-ply").length&&a.append(h.btnadd),a.one("mouseleave",function(){o()})}),t(document).on("click",".btn-note-ply",function(){var e=r(t(this).parent().attr("data-id-note"));t(".btn-speech-ply").attr("globalNumber",e),t(".btn-speech-ply").click()}),t(document).on("click",".btn-speech-ply",function(){var o=t(this).attr("globalNumber");o||(o=t(".btn-speech-ply").attr("number")),o==t(this).attr("number")?b.src?b.paused?(b.play(),e(b)):(b.pause(),e(b)):(a(o),n(s(o)),d(b,0,o,u)):(t(".btn-note-ply.pause").parent().removeClass("activetag"),t(".btn-note-ply.pause").remove(),o?d(b,0,o,u):(a(o=t(this).attr("number")),n(s(o)),d(b,0,o,u)))})})}}});